apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: selfsigned
spec:
  selfSigned: {}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: root-ca
spec:
  secretName: dapr-tls-root
  issuerRef:
    name: selfsigned
  commonName: "Test Root CA"
  isCA: true
  usages:
  - cert signing
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: dapr-tls
spec:
  ca:
    secretName: dapr-tls-root
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: external-tls
spec:
  secretName: external-tls
  issuerRef:
    name: dapr-tls
  dnsNames:
  - "service-invocation-external"
  usages:
  - server auth
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: dapr-tls-client
spec:
  secretName: external-tls
  issuerRef:
    name: dapr-tls
  usages:
  - client auth
---
apiVersion: dapr.io/v1alpha1
kind: HTTPEndpoint
metadata:
  name: "external-http-endpoint-tls"
spec:
  baseUrl: https://service-invocation-external:443
  headers:
  - name: "Accept-Language"
    value: "en-US"
  clientTLS:
    rootCA:
      secretKeyRef:
        name: dapr-tls-client
        key: ca.crt
    certificate:
      secretKeyRef:
        name: dapr-tls-client
        key: tls.crt
    privateKey:
      secretKeyRef:
        name: external-tls
        key: tls.key
