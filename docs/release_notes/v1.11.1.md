# Dapr 1.11.1

## Fixed an issue with Service Invocation on Kubernetes clusters with the permission enforcement admission controller enabled.

### Problem

Updating Dapr from 1.10 to 1.11 on Kubernetes clusters which have the permission enforcement admission controller enabled gives the following error
when using Service Invocation:

```
unable to create Dapr service for wrapper, service: test/test-dapr, err:
services \"test-dapr\" is forbidden: cannot set blockOwnerDeletion if an
ownerReference refers to a resource you can't set finalizers on:
```

### Impact

Since v1.11.0 Service Invocation on Kubernetes clusters which have the permission enforcement admission controller enabled is unusable.

This is particularly problematic when for OpenShift clusters, as they have this admission controller enabled by default.

### Root cause

When using the permission enforcement admission controller on Kubernetes,
Service Invocation fails because the operator is unable to create or update
Services.

### Solution

We updated the Kubernetes RBAC permissions used by the Dapr Operator.

## Fixed a Goroutine leak in Actor reminders and timers.

### Problem

The daprd sidecar process would increase in memory over time when using Actor
reminders and timers.

### Impact

Using Actor reminders and timers in Dapr 1.11.0 and earlier could cause a goroutine leak that would grow over time.
This could cause increase CPU utilization and/or memory exhaustion.

### Root cause

Goroutines were not being cleaned up when reminders and timers were fired.

### Solution

Goroutines are now cleaned up when reminders and timers are fired.

## MongoDB Actor State Store: Fixed an issue with storing Actor Reminders

### Problem

Actor Reminders without data were stored incorrectly and the empty (null) data was subsequently interpreted as a string value. Everytime an Actor Reminder was updated it reencoded the existing encoding, causing exponential growth in ActorReminder data leading up to the MongoDB document size limit. Other problems include the incorrect storage of the actor reminder period.

### Impact

Since v1.10.5 (and also in v1.11.0), Actor Reminders used with MongoDB as Actor State Store were impacted by this bug. While some reminders written or updated with affected versions may work, all reminders written with the impacted versions should be considered unrecoverable as some reminder data may have been corrupted.

### Root cause

The issue was related to the usage of BSON as data serialization format for MongoDB. Due to changes in the Dapr runtime introduced in version 1.10.5, reminders data and periods were incorrectly serialized in BSON format.

### Solution

We addressed the issues with serializing actor reminder data in BSON format for MongoDB.
## Fixed Dapr being unable to obtain the authentication token when using Managed Identity inside Azure App Service

### Problem

When using Managed Identity inside Azure Web Apps (Azure App Service), Dapr shows the following error:

> ChainedTokenCredential: failed to acquire a token.

### Impact

Since v1.11.0, Dapr is unable to authenticate with Azure services using Managed Identity on Azure App Service.

### Root cause

The authentication library's timeout for obtaining a token using Managed Identity on Azure App Service was too small, leading to
authentication failure before the token could be obtained.

### Solution

Dapr will now discover whether it is running in Azure Web App, and applies an
appropriate timeout for the authentication method.

## Fixed a problem where SQL Server keys could not be overwritten once set.

### Problem

Dapr would error when attempting to overwrite a TTL enabled key in SQL Server.

### Impact

Since v1.10.0, clients could not overwrite TTL enabled keys in the SQL Server
state store.

### Root cause

A condition in the SQL Server Set procedure meant TTL enabled keys could never
be written to.

### Solution

Fix the condition to allow TTL enabled keys to be overwritten.
